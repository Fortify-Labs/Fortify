# Sources:
# - https://github.com/zalando/postgres-operator/blob/master/charts/postgres-operator/crds/operatorconfigurations.yaml
# - https://github.com/zalando/postgres-operator/blob/master/charts/postgres-operator/crds/postgresqls.yaml
# - https://github.com/zalando/postgres-operator/blob/master/charts/postgres-operator/crds/postgresteams.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: operatorconfigurations.acid.zalan.do
  labels:
    app.kubernetes.io/name: postgres-operator
  annotations:
    "helm.sh/hook": crd-install
spec:
  group: acid.zalan.do
  names:
    kind: OperatorConfiguration
    listKind: OperatorConfigurationList
    plural: operatorconfigurations
    singular: operatorconfiguration
    shortNames:
      - opconfig
    categories:
      - all
  scope: Namespaced
  versions:
    - name: v1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Image
          type: string
          description: Spilo image to be used for Pods
          jsonPath: .configuration.docker_image
        - name: Cluster-Label
          type: string
          description: Label for K8s resources created by operator
          jsonPath: .configuration.kubernetes.cluster_name_label
        - name: Service-Account
          type: string
          description: Name of service account to be used
          jsonPath: .configuration.kubernetes.pod_service_account_name
        - name: Min-Instances
          type: integer
          description: Minimum number of instances per Postgres cluster
          jsonPath: .configuration.min_instances
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
      schema:
        openAPIV3Schema:
          type: object
          required:
            - kind
            - apiVersion
            - configuration
          properties:
            kind:
              type: string
              enum:
                - OperatorConfiguration
            apiVersion:
              type: string
              enum:
                - acid.zalan.do/v1
            configuration:
              type: object
              properties:
                docker_image:
                  type: string
                  default: "registry.opensource.zalan.do/acid/spilo-13:2.0-p2"
                enable_crd_validation:
                  type: boolean
                  default: true
                enable_lazy_spilo_upgrade:
                  type: boolean
                  default: false
                enable_pgversion_env_var:
                  type: boolean
                  default: true
                enable_shm_volume:
                  type: boolean
                  default: true
                enable_spilo_wal_path_compat:
                  type: boolean
                  default: false
                etcd_host:
                  type: string
                  default: ""
                kubernetes_use_configmaps:
                  type: boolean
                  default: false
                max_instances:
                  type: integer
                  minimum: -1 # -1 = disabled
                  default: -1
                min_instances:
                  type: integer
                  minimum: -1 # -1 = disabled
                  default: -1
                resync_period:
                  type: string
                  default: "30m"
                repair_period:
                  type: string
                  default: "5m"
                set_memory_request_to_limit:
                  type: boolean
                  default: false
                sidecar_docker_images:
                  type: object
                  additionalProperties:
                    type: string
                sidecars:
                  type: array
                  nullable: true
                  items:
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
                workers:
                  type: integer
                  minimum: 1
                  default: 8
                users:
                  type: object
                  properties:
                    replication_username:
                      type: string
                      default: standby
                    super_username:
                      type: string
                      default: postgres
                kubernetes:
                  type: object
                  properties:
                    additional_pod_capabilities:
                      type: array
                      items:
                        type: string
                    cluster_domain:
                      type: string
                      default: "cluster.local"
                    cluster_labels:
                      type: object
                      additionalProperties:
                        type: string
                      default:
                        application: spilo
                    cluster_name_label:
                      type: string
                      default: "cluster-name"
                    custom_pod_annotations:
                      type: object
                      additionalProperties:
                        type: string
                    delete_annotation_date_key:
                      type: string
                    delete_annotation_name_key:
                      type: string
                    downscaler_annotations:
                      type: array
                      items:
                        type: string
                    enable_init_containers:
                      type: boolean
                      default: true
                    enable_pod_antiaffinity:
                      type: boolean
                      default: false
                    enable_pod_disruption_budget:
                      type: boolean
                      default: true
                    enable_sidecars:
                      type: boolean
                      default: true
                    infrastructure_roles_secret_name:
                      type: string
                    infrastructure_roles_secrets:
                      type: array
                      nullable: true
                      items:
                        type: object
                        required:
                          - secretname
                          - userkey
                          - passwordkey
                        properties:
                          secretname:
                            type: string
                          userkey:
                            type: string
                          passwordkey:
                            type: string
                          rolekey:
                            type: string
                          defaultuservalue:
                            type: string
                          defaultrolevalue:
                            type: string
                          details:
                            type: string
                          template:
                            type: boolean
                    inherited_annotations:
                      type: array
                      items:
                        type: string
                    inherited_labels:
                      type: array
                      items:
                        type: string
                    master_pod_move_timeout:
                      type: string
                      default: "20m"
                    node_readiness_label:
                      type: object
                      additionalProperties:
                        type: string
                    oauth_token_secret_name:
                      type: string
                      default: "postgresql-operator"
                    pdb_name_format:
                      type: string
                      default: "postgres-{cluster}-pdb"
                    pod_antiaffinity_topology_key:
                      type: string
                      default: "kubernetes.io/hostname"
                    pod_environment_configmap:
                      type: string
                    pod_environment_secret:
                      type: string
                    pod_management_policy:
                      type: string
                      enum:
                        - "ordered_ready"
                        - "parallel"
                      default: "ordered_ready"
                    pod_priority_class_name:
                      type: string
                    pod_role_label:
                      type: string
                      default: "spilo-role"
                    pod_service_account_definition:
                      type: string
                      default: ""
                    pod_service_account_name:
                      type: string
                      default: "postgres-pod"
                    pod_service_account_role_binding_definition:
                      type: string
                      default: ""
                    pod_terminate_grace_period:
                      type: string
                      default: "5m"
                    secret_name_template:
                      type: string
                      default: "{username}.{cluster}.credentials.{tprkind}.{tprgroup}"
                    spilo_runasuser:
                      type: integer
                    spilo_runasgroup:
                      type: integer
                    spilo_fsgroup:
                      type: integer
                    spilo_privileged:
                      type: boolean
                      default: false
                    storage_resize_mode:
                      type: string
                      enum:
                        - "ebs"
                        - "pvc"
                        - "off"
                      default: "pvc"
                    toleration:
                      type: object
                      additionalProperties:
                        type: string
                    watched_namespace:
                      type: string
                postgres_pod_resources:
                  type: object
                  properties:
                    default_cpu_limit:
                      type: string
                      pattern: '^(\d+m|\d+(\.\d{1,3})?)$'
                      default: "1"
                    default_cpu_request:
                      type: string
                      pattern: '^(\d+m|\d+(\.\d{1,3})?)$'
                      default: "100m"
                    default_memory_limit:
                      type: string
                      pattern: '^(\d+(e\d+)?|\d+(\.\d+)?(e\d+)?[EPTGMK]i?)$'
                      default: "500Mi"
                    default_memory_request:
                      type: string
                      pattern: '^(\d+(e\d+)?|\d+(\.\d+)?(e\d+)?[EPTGMK]i?)$'
                      default: "100Mi"
                    min_cpu_limit:
                      type: string
                      pattern: '^(\d+m|\d+(\.\d{1,3})?)$'
                      default: "250m"
                    min_memory_limit:
                      type: string
                      pattern: '^(\d+(e\d+)?|\d+(\.\d+)?(e\d+)?[EPTGMK]i?)$'
                      default: "250Mi"
                timeouts:
                  type: object
                  properties:
                    pod_label_wait_timeout:
                      type: string
                      default: "10m"
                    pod_deletion_wait_timeout:
                      type: string
                      default: "10m"
                    ready_wait_interval:
                      type: string
                      default: "4s"
                    ready_wait_timeout:
                      type: string
                      default: "30s"
                    resource_check_interval:
                      type: string
                      default: "3s"
                    resource_check_timeout:
                      type: string
                      default: "10m"
                load_balancer:
                  type: object
                  properties:
                    custom_service_annotations:
                      type: object
                      additionalProperties:
                        type: string
                    db_hosted_zone:
                      type: string
                      default: "db.example.com"
                    enable_master_load_balancer:
                      type: boolean
                      default: true
                    enable_replica_load_balancer:
                      type: boolean
                      default: false
                    external_traffic_policy:
                      type: string
                      enum:
                        - "Cluster"
                        - "Local"
                      default: "Cluster"
                    master_dns_name_format:
                      type: string
                      default: "{cluster}.{team}.{hostedzone}"
                    replica_dns_name_format:
                      type: string
                      default: "{cluster}-repl.{team}.{hostedzone}"
                aws_or_gcp:
                  type: object
                  properties:
                    additional_secret_mount:
                      type: string
                    additional_secret_mount_path:
                      type: string
                      default: "/meta/credentials"
                    aws_region:
                      type: string
                      default: "eu-central-1"
                    enable_ebs_gp3_migration:
                      type: boolean
                      default: false
                    enable_ebs_gp3_migration_max_size:
                      type: integer
                      default: 1000
                    gcp_credentials:
                      type: string
                    kube_iam_role:
                      type: string
                    log_s3_bucket:
                      type: string
                    wal_gs_bucket:
                      type: string
                    wal_s3_bucket:
                      type: string
                logical_backup:
                  type: object
                  properties:
                    logical_backup_docker_image:
                      type: string
                      default: "registry.opensource.zalan.do/acid/logical-backup:v1.6.0"
                    logical_backup_google_application_credentials:
                      type: string
                    logical_backup_job_prefix:
                      type: string
                      default: "logical-backup-"
                    logical_backup_provider:
                      type: string
                      default: "s3"
                    logical_backup_s3_access_key_id:
                      type: string
                    logical_backup_s3_bucket:
                      type: string
                    logical_backup_s3_endpoint:
                      type: string
                    logical_backup_s3_region:
                      type: string
                    logical_backup_s3_secret_access_key:
                      type: string
                    logical_backup_s3_sse:
                      type: string
                    logical_backup_schedule:
                      type: string
                      pattern: '^(\d+|\*)(/\d+)?(\s+(\d+|\*)(/\d+)?){4}$'
                      default: "30 00 * * *"
                debug:
                  type: object
                  properties:
                    debug_logging:
                      type: boolean
                      default: true
                    enable_database_access:
                      type: boolean
                      default: true
                teams_api:
                  type: object
                  properties:
                    enable_admin_role_for_users:
                      type: boolean
                      default: true
                    enable_postgres_team_crd:
                      type: boolean
                      default: true
                    enable_postgres_team_crd_superusers:
                      type: boolean
                      default: false
                    enable_team_superuser:
                      type: boolean
                      default: false
                    enable_teams_api:
                      type: boolean
                      default: true
                    pam_configuration:
                      type: string
                      default: "https://info.example.com/oauth2/tokeninfo?access_token= uid realm=/employees"
                    pam_role_name:
                      type: string
                      default: "zalandos"
                    postgres_superuser_teams:
                      type: array
                      items:
                        type: string
                    protected_role_names:
                      type: array
                      items:
                        type: string
                      default:
                        - admin
                    team_admin_role:
                      type: string
                      default: "admin"
                    team_api_role_configuration:
                      type: object
                      additionalProperties:
                        type: string
                      default:
                        log_statement: all
                    teams_api_url:
                      type: string
                      default: "https://teams.example.com/api/"
                logging_rest_api:
                  type: object
                  properties:
                    api_port:
                      type: integer
                      default: 8080
                    cluster_history_entries:
                      type: integer
                      default: 1000
                    ring_log_lines:
                      type: integer
                      default: 100
                scalyr: # deprecated
                  type: object
                  properties:
                    scalyr_api_key:
                      type: string
                    scalyr_cpu_limit:
                      type: string
                      pattern: '^(\d+m|\d+(\.\d{1,3})?)$'
                      default: "1"
                    scalyr_cpu_request:
                      type: string
                      pattern: '^(\d+m|\d+(\.\d{1,3})?)$'
                      default: "100m"
                    scalyr_image:
                      type: string
                    scalyr_memory_limit:
                      type: string
                      pattern: '^(\d+(e\d+)?|\d+(\.\d+)?(e\d+)?[EPTGMK]i?)$'
                      default: "500Mi"
                    scalyr_memory_request:
                      type: string
                      pattern: '^(\d+(e\d+)?|\d+(\.\d+)?(e\d+)?[EPTGMK]i?)$'
                      default: "50Mi"
                    scalyr_server_url:
                      type: string
                      default: "https://upload.eu.scalyr.com"
                connection_pooler:
                  type: object
                  properties:
                    connection_pooler_schema:
                      type: string
                      default: "pooler"
                    connection_pooler_user:
                      type: string
                      default: "pooler"
                    connection_pooler_image:
                      type: string
                      default: "registry.opensource.zalan.do/acid/pgbouncer:master-12"
                    connection_pooler_max_db_connections:
                      type: integer
                      default: 60
                    connection_pooler_mode:
                      type: string
                      enum:
                        - "session"
                        - "transaction"
                      default: "transaction"
                    connection_pooler_number_of_instances:
                      type: integer
                      minimum: 1
                      default: 2
                    connection_pooler_default_cpu_limit:
                      type: string
                      pattern: '^(\d+m|\d+(\.\d{1,3})?)$'
                      default: "1"
                    connection_pooler_default_cpu_request:
                      type: string
                      pattern: '^(\d+m|\d+(\.\d{1,3})?)$'
                      default: "500m"
                    connection_pooler_default_memory_limit:
                      type: string
                      pattern: '^(\d+(e\d+)?|\d+(\.\d+)?(e\d+)?[EPTGMK]i?)$'
                      default: "100Mi"
                    connection_pooler_default_memory_request:
                      type: string
                      pattern: '^(\d+(e\d+)?|\d+(\.\d+)?(e\d+)?[EPTGMK]i?)$'
                      default: "100Mi"
            status:
              type: object
              additionalProperties:
                type: string
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: postgresqls.acid.zalan.do
  labels:
    app.kubernetes.io/name: postgres-operator
  annotations:
    "helm.sh/hook": crd-install
spec:
  group: acid.zalan.do
  names:
    kind: postgresql
    listKind: postgresqlList
    plural: postgresqls
    singular: postgresql
    shortNames:
      - pg
    categories:
      - all
  scope: Namespaced
  versions:
    - name: v1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Team
          type: string
          description: Team responsible for Postgres CLuster
          jsonPath: .spec.teamId
        - name: Version
          type: string
          description: PostgreSQL version
          jsonPath: .spec.postgresql.version
        - name: Pods
          type: integer
          description: Number of Pods per Postgres cluster
          jsonPath: .spec.numberOfInstances
        - name: Volume
          type: string
          description: Size of the bound volume
          jsonPath: .spec.volume.size
        - name: CPU-Request
          type: string
          description: Requested CPU for Postgres containers
          jsonPath: .spec.resources.requests.cpu
        - name: Memory-Request
          type: string
          description: Requested memory for Postgres containers
          jsonPath: .spec.resources.requests.memory
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
        - name: Status
          type: string
          description: Current sync status of postgresql resource
          jsonPath: .status.PostgresClusterStatus
      schema:
        openAPIV3Schema:
          type: object
          required:
            - kind
            - apiVersion
            - spec
          properties:
            kind:
              type: string
              enum:
                - postgresql
            apiVersion:
              type: string
              enum:
                - acid.zalan.do/v1
            spec:
              type: object
              required:
                - numberOfInstances
                - teamId
                - postgresql
                - volume
              properties:
                additionalVolumes:
                  type: array
                  items:
                    type: object
                    required:
                      - name
                      - mountPath
                      - volumeSource
                    properties:
                      name:
                        type: string
                      mountPath:
                        type: string
                      targetContainers:
                        type: array
                        nullable: true
                        items:
                          type: string
                      volumeSource:
                        type: object
                        x-kubernetes-preserve-unknown-fields: true
                      subPath:
                        type: string
                allowedSourceRanges:
                  type: array
                  nullable: true
                  items:
                    type: string
                    pattern: '^(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\/(\d|[1-2]\d|3[0-2])$'
                clone:
                  type: object
                  required:
                    - cluster
                  properties:
                    cluster:
                      type: string
                    s3_endpoint:
                      type: string
                    s3_access_key_id:
                      type: string
                    s3_secret_access_key:
                      type: string
                    s3_force_path_style:
                      type: boolean
                    s3_wal_path:
                      type: string
                    timestamp:
                      type: string
                      pattern: '^([0-9]+)-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])[Tt]([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(([+-]([01][0-9]|2[0-3]):[0-5][0-9]))$'
                      # The regexp matches the date-time format (RFC 3339 Section 5.6) that specifies a timezone as an offset relative to UTC
                      # Example: 1996-12-19T16:39:57-08:00
                      # Note: this field requires a timezone
                    uid:
                      format: uuid
                      type: string
                connectionPooler:
                  type: object
                  properties:
                    dockerImage:
                      type: string
                    maxDBConnections:
                      type: integer
                    mode:
                      type: string
                      enum:
                        - "session"
                        - "transaction"
                    numberOfInstances:
                      type: integer
                      minimum: 2
                    resources:
                      type: object
                      required:
                        - requests
                        - limits
                      properties:
                        limits:
                          type: object
                          required:
                            - cpu
                            - memory
                          properties:
                            cpu:
                              type: string
                              pattern: '^(\d+m|\d+(\.\d{1,3})?)$'
                            memory:
                              type: string
                              pattern: '^(\d+(e\d+)?|\d+(\.\d+)?(e\d+)?[EPTGMK]i?)$'
                        requests:
                          type: object
                          required:
                            - cpu
                            - memory
                          properties:
                            cpu:
                              type: string
                              pattern: '^(\d+m|\d+(\.\d{1,3})?)$'
                            memory:
                              type: string
                              pattern: '^(\d+(e\d+)?|\d+(\.\d+)?(e\d+)?[EPTGMK]i?)$'
                    schema:
                      type: string
                    user:
                      type: string
                databases:
                  type: object
                  additionalProperties:
                    type: string
                  # Note: usernames specified here as database owners must be declared in the users key of the spec key.
                dockerImage:
                  type: string
                enableConnectionPooler:
                  type: boolean
                enableReplicaConnectionPooler:
                  type: boolean
                enableLogicalBackup:
                  type: boolean
                enableMasterLoadBalancer:
                  type: boolean
                enableReplicaLoadBalancer:
                  type: boolean
                enableShmVolume:
                  type: boolean
                init_containers: # deprecated
                  type: array
                  nullable: true
                  items:
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
                initContainers:
                  type: array
                  nullable: true
                  items:
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
                logicalBackupSchedule:
                  type: string
                  pattern: '^(\d+|\*)(/\d+)?(\s+(\d+|\*)(/\d+)?){4}$'
                maintenanceWindows:
                  type: array
                  items:
                    type: string
                    pattern: '^\ *((Mon|Tue|Wed|Thu|Fri|Sat|Sun):(2[0-3]|[01]?\d):([0-5]?\d)|(2[0-3]|[01]?\d):([0-5]?\d))-((Mon|Tue|Wed|Thu|Fri|Sat|Sun):(2[0-3]|[01]?\d):([0-5]?\d)|(2[0-3]|[01]?\d):([0-5]?\d))\ *$'
                numberOfInstances:
                  type: integer
                  minimum: 0
                patroni:
                  type: object
                  properties:
                    initdb:
                      type: object
                      additionalProperties:
                        type: string
                    loop_wait:
                      type: integer
                    maximum_lag_on_failover:
                      type: integer
                    pg_hba:
                      type: array
                      items:
                        type: string
                    retry_timeout:
                      type: integer
                    slots:
                      type: object
                      additionalProperties:
                        type: object
                        additionalProperties:
                          type: string
                    synchronous_mode:
                      type: boolean
                    synchronous_mode_strict:
                      type: boolean
                    ttl:
                      type: integer
                podAnnotations:
                  type: object
                  additionalProperties:
                    type: string
                pod_priority_class_name: # deprecated
                  type: string
                podPriorityClassName:
                  type: string
                postgresql:
                  type: object
                  required:
                    - version
                  properties:
                    version:
                      type: string
                      enum:
                        - "9.3"
                        - "9.4"
                        - "9.5"
                        - "9.6"
                        - "10"
                        - "11"
                        - "12"
                        - "13"
                    parameters:
                      type: object
                      additionalProperties:
                        type: string
                preparedDatabases:
                  type: object
                  additionalProperties:
                    type: object
                    properties:
                      defaultUsers:
                        type: boolean
                      extensions:
                        type: object
                        additionalProperties:
                          type: string
                      schemas:
                        type: object
                        additionalProperties:
                          type: object
                          properties:
                            defaultUsers:
                              type: boolean
                            defaultRoles:
                              type: boolean
                replicaLoadBalancer: # deprecated
                  type: boolean
                resources:
                  type: object
                  required:
                    - requests
                    - limits
                  properties:
                    limits:
                      type: object
                      required:
                        - cpu
                        - memory
                      properties:
                        cpu:
                          type: string
                          # Decimal natural followed by m, or decimal natural followed by
                          # dot followed by up to three decimal digits.
                          #
                          # This is because the Kubernetes CPU resource has millis as the
                          # maximum precision.  The actual values are checked in code
                          # because the regular expression would be huge and horrible and
                          # not very helpful in validation error messages; this one checks
                          # only the format of the given number.
                          #
                          # https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-cpu
                          pattern: '^(\d+m|\d+(\.\d{1,3})?)$'
                          # Note: the value specified here must not be zero or be lower
                          # than the corresponding request.
                        memory:
                          type: string
                          # You can express memory as a plain integer or as a fixed-point
                          # integer using one of these suffixes: E, P, T, G, M, k. You can
                          # also use the power-of-two equivalents: Ei, Pi, Ti, Gi, Mi, Ki
                          #
                          # https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-memory
                          pattern: '^(\d+(e\d+)?|\d+(\.\d+)?(e\d+)?[EPTGMK]i?)$'
                          # Note: the value specified here must not be zero or be higher
                          # than the corresponding limit.
                    requests:
                      type: object
                      required:
                        - cpu
                        - memory
                      properties:
                        cpu:
                          type: string
                          pattern: '^(\d+m|\d+(\.\d{1,3})?)$'
                        memory:
                          type: string
                          pattern: '^(\d+(e\d+)?|\d+(\.\d+)?(e\d+)?[EPTGMK]i?)$'
                schedulerName:
                  type: string
                serviceAnnotations:
                  type: object
                  additionalProperties:
                    type: string
                sidecars:
                  type: array
                  nullable: true
                  items:
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
                spiloRunAsUser:
                  type: integer
                spiloRunAsGroup:
                  type: integer
                spiloFSGroup:
                  type: integer
                standby:
                  type: object
                  required:
                    - s3_wal_path
                  properties:
                    s3_wal_path:
                      type: string
                teamId:
                  type: string
                tls:
                  type: object
                  required:
                    - secretName
                  properties:
                    secretName:
                      type: string
                    certificateFile:
                      type: string
                    privateKeyFile:
                      type: string
                    caFile:
                      type: string
                    caSecretName:
                      type: string
                nodeAffinity:
                  type: object
                  properties:
                    preferredDuringSchedulingIgnoredDuringExecution:
                      type: array
                      items:
                        type: object
                        required:
                          - weight
                          - preference
                        properties:
                          preference:
                            type: object
                            properties:
                              matchExpressions:
                                type: array
                                items:
                                  type: object
                                  required:
                                    - key
                                    - operator
                                  properties:
                                    key:
                                      type: string
                                    operator:
                                      type: string
                                    values:
                                      type: array
                                      items:
                                        type: string
                              matchFields:
                                type: array
                                items:
                                  type: object
                                  required:
                                    - key
                                    - operator
                                  properties:
                                    key:
                                      type: string
                                    operator:
                                      type: string
                                    values:
                                      type: array
                                      items:
                                        type: string
                          weight:
                            format: int32
                            type: integer
                    requiredDuringSchedulingIgnoredDuringExecution:
                      type: object
                      required:
                        - nodeSelectorTerms
                      properties:
                        nodeSelectorTerms:
                          type: array
                          items:
                            type: object
                            properties:
                              matchExpressions:
                                type: array
                                items:
                                  type: object
                                  required:
                                    - key
                                    - operator
                                  properties:
                                    key:
                                      type: string
                                    operator:
                                      type: string
                                    values:
                                      type: array
                                      items:
                                        type: string
                              matchFields:
                                type: array
                                items:
                                  type: object
                                  required:
                                    - key
                                    - operator
                                  properties:
                                    key:
                                      type: string
                                    operator:
                                      type: string
                                    values:
                                      type: array
                                      items:
                                        type: string
                tolerations:
                  type: array
                  items:
                    type: object
                    required:
                      - key
                      - operator
                      - effect
                    properties:
                      key:
                        type: string
                      operator:
                        type: string
                        enum:
                          - Equal
                          - Exists
                      value:
                        type: string
                      effect:
                        type: string
                        enum:
                          - NoExecute
                          - NoSchedule
                          - PreferNoSchedule
                      tolerationSeconds:
                        type: integer
                useLoadBalancer: # deprecated
                  type: boolean
                users:
                  type: object
                  additionalProperties:
                    type: array
                    nullable: true
                    description: "Role flags specified here must not contradict each other"
                    items:
                      type: string
                      enum:
                        - bypassrls
                        - BYPASSRLS
                        - nobypassrls
                        - NOBYPASSRLS
                        - createdb
                        - CREATEDB
                        - nocreatedb
                        - NOCREATEDB
                        - createrole
                        - CREATEROLE
                        - nocreaterole
                        - NOCREATEROLE
                        - inherit
                        - INHERIT
                        - noinherit
                        - NOINHERIT
                        - login
                        - LOGIN
                        - nologin
                        - NOLOGIN
                        - replication
                        - REPLICATION
                        - noreplication
                        - NOREPLICATION
                        - superuser
                        - SUPERUSER
                        - nosuperuser
                        - NOSUPERUSER
                volume:
                  type: object
                  required:
                    - size
                  properties:
                    iops:
                      type: integer
                    size:
                      type: string
                      pattern: '^(\d+(e\d+)?|\d+(\.\d+)?(e\d+)?[EPTGMK]i?)$'
                      # Note: the value specified here must not be zero.
                    storageClass:
                      type: string
                    subPath:
                      type: string
                    throughput:
                      type: integer
            status:
              type: object
              additionalProperties:
                type: string
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: postgresteams.acid.zalan.do
  labels:
    app.kubernetes.io/name: postgres-operator
  annotations:
    "helm.sh/hook": crd-install
spec:
  group: acid.zalan.do
  names:
    kind: PostgresTeam
    listKind: PostgresTeamList
    plural: postgresteams
    singular: postgresteam
    shortNames:
      - pgteam
    categories:
      - all
  scope: Namespaced
  versions:
    - name: v1
      served: true
      storage: true
      subresources:
        status: {}
      schema:
        openAPIV3Schema:
          type: object
          required:
            - kind
            - apiVersion
            - spec
          properties:
            kind:
              type: string
              enum:
                - PostgresTeam
            apiVersion:
              type: string
              enum:
                - acid.zalan.do/v1
            spec:
              type: object
              properties:
                additionalSuperuserTeams:
                  type: object
                  description: "Map for teamId and associated additional superuser teams"
                  additionalProperties:
                    type: array
                    nullable: true
                    description: "List of teams to become Postgres superusers"
                    items:
                      type: string
                additionalTeams:
                  type: object
                  description: "Map for teamId and associated additional teams"
                  additionalProperties:
                    type: array
                    nullable: true
                    description: "List of teams whose members will also be added to the Postgres cluster"
                    items:
                      type: string
                additionalMembers:
                  type: object
                  description: "Map for teamId and associated additional users"
                  additionalProperties:
                    type: array
                    nullable: true
                    description: "List of users who will also be added to the Postgres cluster"
                    items:
                      type: string
